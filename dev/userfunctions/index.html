<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>User problem ¬∑ FESolvers.jl</title><meta name="title" content="User problem ¬∑ FESolvers.jl"/><meta property="og:title" content="User problem ¬∑ FESolvers.jl"/><meta property="twitter:title" content="User problem ¬∑ FESolvers.jl"/><meta name="description" content="Documentation for FESolvers.jl."/><meta property="og:description" content="Documentation for FESolvers.jl."/><meta property="twitter:description" content="Documentation for FESolvers.jl."/><meta property="og:url" content="https://KnutAM.github.io/FESolvers.jl/userfunctions/"/><meta property="twitter:url" content="https://KnutAM.github.io/FESolvers.jl/userfunctions/"/><link rel="canonical" href="https://KnutAM.github.io/FESolvers.jl/userfunctions/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">FESolvers.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Manual</span><ul><li class="is-active"><a class="tocitem" href>User problem</a><ul class="internal"><li><a class="tocitem" href="#Applicable-to-all-solvers"><span>Applicable to all solvers</span></a></li><li><a class="tocitem" href="#Simple-API"><span>Simple API</span></a></li><li><a class="tocitem" href="#Advanced-API"><span>Advanced API</span></a></li><li><a class="tocitem" href="#Additional-functions"><span>Additional functions</span></a></li></ul></li><li><a class="tocitem" href="../nlsolvers/">Nonlinear solvers</a></li><li><a class="tocitem" href="../timesteppers/">Time steppers</a></li><li><a class="tocitem" href="../linearsolvers/">Linear solvers</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples/plasticity/">Plasticity</a></li><li><a class="tocitem" href="../examples/transient_heat/">Linear Time Dependent Problem</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>User problem</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>User problem</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/KnutAM/FESolvers.jl/blob/main/docs/src/userfunctions.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid">ÔÅÑ</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="User-problem"><a class="docs-heading-anchor" href="#User-problem">User problem</a><a id="User-problem-1"></a><a class="docs-heading-anchor-permalink" href="#User-problem" title="Permalink"></a></h1><p>The key to using the <code>FESolvers.jl</code> package is to define your  <code>problem</code>. This <code>problem</code> should support a set of functions in order for the solver to solve your <code>problem</code>.  While some functions are always required, some are only required by certain solvers.  Furthermore, a two-level API exist: Simple and advanced.  The simple API does not expose which solver is used, while the advanced API requires you to dispatch on the type of solver. </p><h2 id="Applicable-to-all-solvers"><a class="docs-heading-anchor" href="#Applicable-to-all-solvers">Applicable to all solvers</a><a id="Applicable-to-all-solvers-1"></a><a class="docs-heading-anchor-permalink" href="#Applicable-to-all-solvers" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FESolvers.getunknowns" href="#FESolvers.getunknowns"><code>FESolvers.getunknowns</code></a> ‚Äî <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">getunknowns(problem)</code></pre><p>Return the current vector of unknown values</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KnutAM/FESolvers.jl/blob/ff866a3ecb7a66c28f0317e07adbe2070cb5786f/src/problem.jl#L1-L5">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FESolvers.getresidual" href="#FESolvers.getresidual"><code>FESolvers.getresidual</code></a> ‚Äî <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">getresidual(problem)</code></pre><p>Return the current residual vector of the problem</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KnutAM/FESolvers.jl/blob/ff866a3ecb7a66c28f0317e07adbe2070cb5786f/src/problem.jl#L8-L12">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FESolvers.update_to_next_step!" href="#FESolvers.update_to_next_step!"><code>FESolvers.update_to_next_step!</code></a> ‚Äî <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">update_to_next_step!(problem, time)</code></pre><p>Update prescribed values, external loads etc. for the given time.</p><p>This function is called in the beginning of each new time step.  Note that for adaptive time stepping, it may be called with a lower  time than the previous time if the solution did not converge.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KnutAM/FESolvers.jl/blob/ff866a3ecb7a66c28f0317e07adbe2070cb5786f/src/problem.jl#L56-L64">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FESolvers.update_problem!" href="#FESolvers.update_problem!"><code>FESolvers.update_problem!</code></a> ‚Äî <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">update_problem!(problem, Œîx, update_spec::UpdateSpec)</code></pre><p>Update the unknowns of the problem by <code>Œîx</code> according to <code>update_spec</code>. Note that </p><ul><li>Some linear solvers may be inaccurate, and if a modified stiffness is used  to enforce constraints on <code>x</code>, it is good the force <code>Œîx=0</code> on these components inside this function. </li><li><code>Œîx=nothing</code> in the first call after <a href="#FESolvers.update_to_next_step!"><code>update_to_next_step!</code></a> in which case, typically, no change of <code>x</code> should be made. Dirichlet boundary conditions are typically updated in <code>update_to_next_step!</code>.</li></ul><p>The <code>update_spec</code> gives the information about what and how to update. See the documentation for <a href="../nlsolvers/#FESolvers.UpdateSpec"><code>UpdateSpec</code></a> for further details.  This feature is used by some nonlinear solvers to customize the iteration  strategy to speed up or aid convergence. For basic cases when getting started,  this can be ignored and a simple function definition would be </p><pre><code class="language-julia hljs">FESolvers.update_problem!(problem, Œîx, _)</code></pre><pre><code class="nohighlight hljs">update_problem!(problem, Œîx; update_residual::Bool, update_jacobian::Bool)</code></pre><p>The old but now deprecated interface is still available without <code>update_spec</code>. The instructions are here:</p><ul><li>Assemble the residual if <code>update_residual=true</code></li><li>Assemble the jacobian if <code>update_jacobian=true</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KnutAM/FESolvers.jl/blob/ff866a3ecb7a66c28f0317e07adbe2070cb5786f/src/problem.jl#L67-L97">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FESolvers.handle_converged!" href="#FESolvers.handle_converged!"><code>FESolvers.handle_converged!</code></a> ‚Äî <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">handle_converged!(problem)</code></pre><p>Do necessary update operations once it is known that the  problem has converged. E.g., update old values to the current.  Only called after the problem has converged, after <code>postprocess!</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KnutAM/FESolvers.jl/blob/ff866a3ecb7a66c28f0317e07adbe2070cb5786f/src/problem.jl#L127-L133">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FESolvers.handle_notconverged!" href="#FESolvers.handle_notconverged!"><code>FESolvers.handle_notconverged!</code></a> ‚Äî <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">handle_notconverged!(problem, solver)</code></pre><p>Optional function to make changes to the problem in case it did not converge. If not implemented, this defaults to a no-op.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KnutAM/FESolvers.jl/blob/ff866a3ecb7a66c28f0317e07adbe2070cb5786f/src/problem.jl#L136-L141">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FESolvers.postprocess!" href="#FESolvers.postprocess!"><code>FESolvers.postprocess!</code></a> ‚Äî <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">postprocess!(problem, solver)</code></pre><p>Perform any postprocessing at the current time. Called at the beginning of the simulation, and directly after time step converged (right before <code>handle_converged!</code>).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KnutAM/FESolvers.jl/blob/ff866a3ecb7a66c28f0317e07adbe2070cb5786f/src/problem.jl#L112-L118">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FESolvers.close_problem" href="#FESolvers.close_problem"><code>FESolvers.close_problem</code></a> ‚Äî <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">close_problem(problem)</code></pre><p>This function is called after solving the problem, even if the solution  fails due to an error thrown, for example if the problem doesn&#39;t converge.  Use to close any file streams etc. that are open and should be closed</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KnutAM/FESolvers.jl/blob/ff866a3ecb7a66c28f0317e07adbe2070cb5786f/src/problem.jl#L155-L161">source</a></section></article><h2 id="Simple-API"><a class="docs-heading-anchor" href="#Simple-API">Simple API</a><a id="Simple-API-1"></a><a class="docs-heading-anchor-permalink" href="#Simple-API" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FESolvers.calculate_convergence_measure" href="#FESolvers.calculate_convergence_measure"><code>FESolvers.calculate_convergence_measure</code></a> ‚Äî <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">calculate_convergence_measure(problem, Œîa, iter) -&gt; AbstractFloat</code></pre><p>Calculate a value to be compared with the tolerance of the nonlinear solver.  A standard case when using <a href="https://github.com/Ferrite-FEM/Ferrite.jl">Ferrite.jl</a> is <code>norm(getresidual(problem)[Ferrite.free_dofs(ch)])</code>  where <code>ch::Ferrite.ConstraintHandler</code>. <code>Œîa</code> is the update of the unknowns from  the previous iteration. Note that <code>iter=1</code> implies <code>Œîa=0</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KnutAM/FESolvers.jl/blob/ff866a3ecb7a66c28f0317e07adbe2070cb5786f/src/problem.jl#L101-L109">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FESolvers.getjacobian" href="#FESolvers.getjacobian"><code>FESolvers.getjacobian</code></a> ‚Äî <span class="docstring-category">Function</span></header><section><div><p>getjacobian(problem)</p><p>Return the jacobian <code>drdx</code>, or approximations thereof.</p><p>Must be defined for <code>NewtonSolver</code>, but can also be  defined by the advanced API alternative <a href="#FESolvers.getsystemmatrix"><code>getsystemmatrix</code></a>:  <code>getsystemmatrix(problem, ::NewtonSolver)</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KnutAM/FESolvers.jl/blob/ff866a3ecb7a66c28f0317e07adbe2070cb5786f/src/problem.jl#L15-L23">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FESolvers.getdescentpreconditioner" href="#FESolvers.getdescentpreconditioner"><code>FESolvers.getdescentpreconditioner</code></a> ‚Äî <span class="docstring-category">Function</span></header><section><div><p>getdescentpreconditioner(problem)</p><p>Return a preconditioner <code>K</code> for calculating the descent direction <code>p</code>, considering solving <code>r(x)=0</code> as a minimization problem of <code>f(x)</code> where <code>r=‚àáf</code>. The descent direction is then <code>p = K‚Åª¬π ‚àáf</code></p><p>Used by the <code>SteepestDescent</code> solver, and defaults to <code>I</code> if not defined.  The advanced API alternative is <a href="#FESolvers.getsystemmatrix"><code>getsystemmatrix</code></a>:  <code>getsystemmatrix(problem, ::SteepestDescent)</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KnutAM/FESolvers.jl/blob/ff866a3ecb7a66c28f0317e07adbe2070cb5786f/src/problem.jl#L25-L35">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FESolvers.calculate_energy" href="#FESolvers.calculate_energy"><code>FESolvers.calculate_energy</code></a> ‚Äî <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">calculate_energy(problem,ùêÆ)</code></pre><p>Return the energy of the system (a scalar) which is the integrated energy density over the domain Œ©.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KnutAM/FESolvers.jl/blob/ff866a3ecb7a66c28f0317e07adbe2070cb5786f/src/problem.jl#L48-L53">source</a></section></article><h2 id="Advanced-API"><a class="docs-heading-anchor" href="#Advanced-API">Advanced API</a><a id="Advanced-API-1"></a><a class="docs-heading-anchor-permalink" href="#Advanced-API" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FESolvers.getsystemmatrix" href="#FESolvers.getsystemmatrix"><code>FESolvers.getsystemmatrix</code></a> ‚Äî <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">getsystemmatrix(problem,nlsolver)</code></pre><p>Return the system matrix of the problem. For a Newton solver this method should return the Jacobian, while for a steepest descent method this can be a preconditioner as e.g., the L2 product of the gradients. By default the system matrix for the <code>SteepestDescent</code> method is the unity matrix and thus, renders a vanilla gradient descent solver.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KnutAM/FESolvers.jl/blob/ff866a3ecb7a66c28f0317e07adbe2070cb5786f/src/problem.jl#L37-L45">source</a></section></article><h2 id="Additional-functions"><a class="docs-heading-anchor" href="#Additional-functions">Additional functions</a><a id="Additional-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Additional-functions" title="Permalink"></a></h2><p>These functions are usually not necessary to overload </p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="FESolvers.setunknowns!" href="#FESolvers.setunknowns!"><code>FESolvers.setunknowns!</code></a> ‚Äî <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">setunknowns!(problem, x)</code></pre><p>Copy the given values <code>x</code> into the unknown values of <code>problem</code>.  Defaults to <code>copy!(getunknowns(problem), x)</code>, which works as long as <code>getunknowns</code> returns the <code>Vector{&lt;:Number}</code> stored in the problem struct.  If, e.g. the unknowns is a custom type or a nested vector, this function should  be overloaded. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/KnutAM/FESolvers.jl/blob/ff866a3ecb7a66c28f0317e07adbe2070cb5786f/src/problem.jl#L144-L152">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">¬´ Home</a><a class="docs-footer-nextpage" href="../nlsolvers/">Nonlinear solvers ¬ª</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.0 on <span class="colophon-date" title="Saturday 20 April 2024 23:30">Saturday 20 April 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
